#include "../shared.h"

struct Lod_params {
  struct Lod_brush_params {
    float4 brush_uv[4];
    float base_radius;
    float radius_variation;
    float radius_random;
    float blur;
    float alpha;
    float stretch;
  } brushes;
  struct Lod_noise_params {
    float chaos;
    float freq;
    float brightness;
    float saturation;
    float hue;
  } noise;
  struct Lod_outlines_params {
    float2 thickness;
    float2 softness;
    float2 displacement;
    float2 attenuation;
    float lighting_threshold;
    float lighting_threshold_softness;
    float2 lighting_dark;
    float2 lighting_bright;
    float2 discretion;
    float2 alpha;
  } outlines;
};

struct Frame_constants {
  float3 cam_world_pos;
  float time;
  float2 inv_near_dim;
  float proj_scale;
  uint flags;
  float2 half_vp_dim;
  int2 vp_dim;
  float2 vp_texel_size;
  int2 mouse_pos;
  int2 inspected_pix;
  int2 hi_z_0_dim;
  int supersampling;
  int debug_patches;
  int use_patches;
  int emissive;
  float3 target;
  uint frame_number;
  uint shot_frame_number;
  float dt;
  float4 view_to_world[4];
  float4 world_to_view[4];
  float4 view_ndc[4];
  float4 world_ndc[4];
  float4 prev_world_ndc[4];
  float4 ndc_world[4];
  float4 ndc_to_prev_ndc[4];
  float4 prev_ndc_to_ndc[4];
  float4 view_world_z0;
  float4 pix_to_fog_eq;
  float3 mio_view;
  float3 mio_hair_outline_color;
  float mio_foliage_velocity;
  int show_wireframe;
  int ao;
  int glitch;
  int no_vertex_color;
  float paper_mult;
  int hatching;
  int mio_halo;
  int vol_temporal;
  int heart_attack_active;
  int heart_attack_secondary_target;
  int triangular_dissolve_enabled;
  int color_correct;
  float starfield_effect_amount;
  float starfield_fade_amount;
  float3 starfield_center_view;
  float starfield_glow_amount;
  float starfield_pulse_t;
  float death_anim_t;
  float3 game_plane_world_origin;
  float3 game_plane_world_normal;
  float3 game_plane_world_u;
  float3 game_plane_world_v;
  float4 game_plane_transform[4];
  float4 hatching_xf[4];
  float4 paper_xf[4];
  float2 game_plane_blend;
  float heart_attack_t;
  float heart_attack_duration;
  float heart_attack_pulse;
  float heart_attack_outline_distance;
  float heart_attack_dissolve_distance;
  float3 heart_attack_dissolve_color;
  float heart_attack_dissolve_base;
  float heart_attack_dissolve_mult;
  float3 heart_attack_dissolve_world_center;
  float heart_attack_vertical_dissolve;
  float triangular_dissolve_base_amount;
  float triangular_dissolve_amount;
  float flashback_lut;
  float evil_mio;
  float dead_mio;
  float godlike_mio;
  float khlia_pulse_t;
  float khlia__pulse_t;
  float khlia_pulse_period;
  float3 khlia_world_pos;
  float skydome_rotation_offset;
  float hatch_ambiant_mul;
  float hatch_ambiant_add;
  float glitch_scale;
  uint max_contours;
  uint max_contour_loops;
  int death_screen;
  float death_screen_t;
  int poetic_death_screen;
  float poetic_death_screen_t;
  float tremor_pulse_t;
  int invert;
  float surface_fade;
  struct Postprocess_params {
    struct AO_params {
      float3 color;
      float intensity;
    } ao;
    struct Fog_params {
      float bloom_factor;
      float space;
      float outline_density;
      float outline_attenuation;
    } fog;
    struct Ambient_light_params {
      int undercoat_grad;
      float3 color;
      float intensity;
      float gameplay_intensity;
      float gameplay_width;
      float directional_intensity;
      float directional_shadows;
      float undercoat_noise_freq;
      float undercoat_noise_amplitude;
      float undercoat_noise_threshold;
      float undercoating;
    } ambient_light;
    struct Vignette_params {
      float intensity;
      float rounded;
      float3 color;
      float golden_intensity;
      float golden_color;
    } vignette;
    struct Bloom_params {
      float intensity;
      float threshold_low;
      float threshold_high;
    } bloom;
    struct Mio_params {
      float light_intensity;
      float light_radius;
      float3 light_color;
      float spec_intensity;
      float3 halo_color;
      float halo_intensity;
    } mio;
    struct Particles_params {
      uint count;
      float cam_near;
      float cam_far;
      float fadeoff_near;
      float2 lifetime;
      float fadein_duration;
      float fadeoff_duration;
      float2 alpha;
      float2 scale;
      float2 speed;
      int gradient;
      float circle_attenuation;
    } particles;
    struct Chroma_aberration_params {
      float intensity;
    } chroma_aberration;
    struct Fade_params {
      float intensity;
      float3 color;
    } fade;
    struct Dof_params {
      float plane_01;
      float plane_01_softness;
      float plane_12;
      float plane_12_softness;
      float foreground;
      float foreground_softness;
    } dof;
    Lod_params lod_foreground;
    Lod_params lod_game;
    Lod_params lod_midground;
    Lod_params lod_background;
  } params;
};


Texture2D<float4> tex : register(t0);

Texture2D<float> depth_tex : register(t1);

Texture2D<float2> distortion : register(t4);

Texture2D<float> paper_tex : register(t5);

Texture2D<float3> bloom_tex : register(t7);

cbuffer frame_consts : register(b0) {
  Frame_constants frame_consts : packoffset(c000.x);
};

SamplerState sampler_nearest : register(s0);

SamplerState sampler_bilinear : register(s1);

SamplerState sampler_bilinear_wrap : register(s2);

float4 main(
  noperspective float4 SV_Position : SV_Position,
  linear float2 O_Uv : O_Uv
) : SV_Target {
  float4 SV_Target;
  float _15 = float((int)(frame_consts.vp_dim.x));
  float _16 = float((int)(frame_consts.vp_dim.y));
  float2 _17 = distortion.SampleLevel(sampler_nearest, float2(O_Uv.x, O_Uv.y), 0.0f);
  float _20 = _16 / _15;
  float _25 = saturate((_17.x * _20) + O_Uv.x);
  float _26 = saturate((_17.y * _20) + O_Uv.y);
  float4 _27 = tex.SampleLevel(sampler_nearest, float2(_25, _26), 0.0f);
  float3 _31 = bloom_tex.SampleLevel(sampler_bilinear, float2(_25, _26), 0.0f);
  float _46 = max((((1.0f - (_27.y * 0.7152000069618225f)) - (_27.x * 0.2125999927520752f)) - (_27.z * 0.0722000002861023f)), 0.0010000000474974513f);
  float _50 = (_27.x / _46) + (frame_consts.params.bloom.intensity * _31.x);
  float _51 = (_27.y / _46) + (frame_consts.params.bloom.intensity * _31.y);
  float _52 = (_27.z / _46) + (frame_consts.params.bloom.intensity * _31.z);
  float _58 = (((_50 * 0.2125999927520752f) + 1.0f) + (_51 * 0.7152000069618225f)) + (_52 * 0.0722000002861023f);
  float _62 = saturate(_50 / _58);
  float _63 = saturate(_51 / _58);
  float _64 = saturate(_52 / _58);
  float _70 = depth_tex.SampleLevel(sampler_nearest, float2(_25, _26), 0.0f);
  float _74 = 10000.0f / ((_70.x * 19999.5f) + 0.5f);
  float _79 = (_74 * ((_25 * 2.0f) + -1.0f)) * frame_consts.inv_near_dim.x;
  float _81 = (_74 * (((1.0f - _26) * 2.0f) + -1.0f)) * frame_consts.inv_near_dim.y;
  float _82 = -0.0f - _74;
  float _106 = mad((frame_consts.paper_xf[2].z), _82, mad((frame_consts.paper_xf[1].z), _81, (_79 * (frame_consts.paper_xf[0].z))));
  float _118 = exp2(round(log2(max(5.0f, (-0.0f - (_106 - frame_consts.game_plane_blend.x)))) * 10.0f) * 0.10000000149011612f);
  float _120 = min((1.0f / _118), 0.20000000298023224f);
  float _121 = frame_consts.game_plane_blend.x - _118;
  float _128 = paper_tex.SampleLevel(sampler_bilinear_wrap, float2((((_121 * (mad((frame_consts.paper_xf[2].x), _82, mad((frame_consts.paper_xf[1].x), _81, (_79 * (frame_consts.paper_xf[0].x)))) / _106)) + (frame_consts.paper_xf[3].x)) * _120), (((_121 * (mad((frame_consts.paper_xf[2].y), _82, mad((frame_consts.paper_xf[1].y), _81, (_79 * (frame_consts.paper_xf[0].y)))) / _106)) + (frame_consts.paper_xf[3].y)) * _120)), 0.0f);
  float _133 = (1.0f - _128.x) * frame_consts.paper_mult;
  float _148 = _15 / _16;
  float _160 = exp2(log2(saturate((frame_consts.params.vignette.intensity * abs(_25 + -0.5f)) * (((_148 + -1.0f) * frame_consts.params.vignette.rounded) + 1.0f))) * 5.0f);
  float _161 = exp2(log2(saturate(frame_consts.params.vignette.intensity * abs(_26 + -0.5f))) * 5.0f);
  float _167 = exp2(log2(saturate(1.0f - dot(float2(_160, _161), float2(_160, _161)))) * 6.0f);
  float _172 = 1.0f - _167;
  float _174 = 1.0f - (_172 * 0.8500000238418579f);
  float _181 = (_174 * ((_62 - (_133 * _62)) - frame_consts.params.vignette.color.x)) + frame_consts.params.vignette.color.x;
  float _182 = (_174 * ((_63 - (_133 * _63)) - frame_consts.params.vignette.color.y)) + frame_consts.params.vignette.color.y;
  float _183 = (_174 * ((_64 - (_133 * _64)) - frame_consts.params.vignette.color.z)) + frame_consts.params.vignette.color.z;
  float _187 = _25 * _15;
  float _188 = _26 * _16;
  float _189 = _188 + _187;
  float _195 = frac(_189 * 0.0033333334140479565f) + -0.5f;
  float _196 = frac((_188 - _187) * 0.0033333334140479565f) + -0.5f;
  float _202 = saturate(sqrt((_196 * _196) + (_195 * _195)) * 2.0f);
  float _213 = saturate((sin((_189 * 0.01666666753590107f) - (frame_consts.time * 0.8500000238418579f)) * 1.2500001192092896f) + -0.25000008940696716f);
  float _218 = ((_213 * _213) * 0.2199999988079071f) * (3.0f - (_213 * 2.0f));
  float _219 = _218 + 0.9777389168739319f;
  float _220 = ((_202 * 0.13274884223937988f) + 0.7175776362419128f) + _218;
  float _221 = ((_202 * 0.3335757553577423f) + 0.30871906876564026f) + _218;
  float _226 = (_25 * 1080.0f) * _148;
  float _227 = _26 * 1080.0f;
  float _228 = _226 * 0.04444444552063942f;
  float _229 = _26 * 27.712812423706055f;
  float _231 = ceil(_228 - _229);
  float _234 = floor(_26 * 55.42562484741211f) + 1.0f;
  float _237 = ceil((-0.0f - _229) - _228);
  float _239 = (_234 + _231) + _237;
  float _241 = (_239 * 22.5f) + -33.75f;
  float _242 = _231 - _237;
  float _244 = _242 * 11.25f;
  float _250 = (((_234 * 0.5773502588272095f) - (_231 * 0.28867512941360474f)) - (_237 * 0.28867512941360474f)) * 22.5f;
  float _253 = _241 + _244;
  float _254 = _250 + (19.485570907592773f - (_239 * 12.990381240844727f));
  float _257 = ((_239 * 25.980762481689453f) + -38.97114181518555f) + _250;
  float _258 = _244 - _241;
  float _259 = _253 - _226;
  float _260 = _254 - _227;
  float _263 = _244 - _226;
  float _264 = _257 - _227;
  float _269 = _260 * _260;
  float _276 = _258 - _226;
  float _280 = _254 * 2.5f;
  float _281 = frame_consts.time * 1.5f;
  float _285 = _254 * 0.004444444552063942f;
  float _286 = frame_consts.time * 0.15000000596046448f;
  float _287 = (_253 * 0.04444444552063942f) - _286;
  float _288 = _285 - _286;
  float _289 = frame_consts.time * 0.02500000037252903f;
  float _290 = dot(float3(_287, _288, _289), float3(0.3333333432674408f, 0.3333333432674408f, 0.3333333432674408f));
  float _294 = floor(_290 + _287);
  float _295 = floor(_290 + _288);
  float _296 = floor(_290 + _289);
  float _300 = dot(float3(_294, _295, _296), float3(0.1666666716337204f, 0.1666666716337204f, 0.1666666716337204f));
  float _301 = _300 + (_287 - _294);
  float _302 = _300 + (_288 - _295);
  float _303 = (_289 - _296) + _300;
  float _307 = select((_301 < _302), 0.0f, 1.0f);
  float _308 = select((_302 < _303), 0.0f, 1.0f);
  float _309 = select((_303 < _301), 0.0f, 1.0f);
  float _310 = 1.0f - _307;
  float _311 = 1.0f - _308;
  float _312 = 1.0f - _309;
  float _313 = min(_307, _312);
  float _314 = min(_308, _310);
  float _315 = min(_309, _311);
  float _316 = max(_307, _312);
  float _317 = max(_308, _310);
  float _318 = max(_309, _311);
  float _322 = (_301 - _313) + 0.1666666716337204f;
  float _323 = (_302 - _314) + 0.1666666716337204f;
  float _324 = (_303 - _315) + 0.1666666716337204f;
  float _328 = (_301 - _316) + 0.3333333432674408f;
  float _329 = (_302 - _317) + 0.3333333432674408f;
  float _330 = (_303 - _318) + 0.3333333432674408f;
  float _331 = _301 + -0.5f;
  float _332 = _302 + -0.5f;
  float _333 = _303 + -0.5f;
  float _343 = _294 - (floor(_294 * 0.0034602077212184668f) * 289.0f);
  float _344 = _295 - (floor(_295 * 0.0034602077212184668f) * 289.0f);
  float _345 = _296 - (floor(_296 * 0.0034602077212184668f) * 289.0f);
  float _346 = _345 + _315;
  float _347 = _345 + _318;
  float _348 = _345 + 1.0f;
  float _357 = ((_345 * 34.0f) + 1.0f) * _345;
  float _358 = ((_346 * 34.0f) + 1.0f) * _346;
  float _359 = ((_347 * 34.0f) + 1.0f) * _347;
  float _360 = ((_348 * 34.0f) + 1.0f) * _348;
  float _374 = (_357 - (floor(_357 * 0.0034602077212184668f) * 289.0f)) + _344;
  float _377 = ((_344 + _314) - (floor(_358 * 0.0034602077212184668f) * 289.0f)) + _358;
  float _380 = ((_344 + _317) - (floor(_359 * 0.0034602077212184668f) * 289.0f)) + _359;
  float _383 = ((_344 + 1.0f) - (floor(_360 * 0.0034602077212184668f) * 289.0f)) + _360;
  float _392 = ((_374 * 34.0f) + 1.0f) * _374;
  float _393 = ((_377 * 34.0f) + 1.0f) * _377;
  float _394 = ((_380 * 34.0f) + 1.0f) * _380;
  float _395 = ((_383 * 34.0f) + 1.0f) * _383;
  float _409 = (_392 - (floor(_392 * 0.0034602077212184668f) * 289.0f)) + _343;
  float _412 = ((_343 + _313) - (floor(_393 * 0.0034602077212184668f) * 289.0f)) + _393;
  float _415 = ((_343 + _316) - (floor(_394 * 0.0034602077212184668f) * 289.0f)) + _394;
  float _418 = ((_343 + 1.0f) - (floor(_395 * 0.0034602077212184668f) * 289.0f)) + _395;
  float _427 = ((_409 * 34.0f) + 1.0f) * _409;
  float _428 = ((_412 * 34.0f) + 1.0f) * _412;
  float _429 = ((_415 * 34.0f) + 1.0f) * _415;
  float _430 = ((_418 * 34.0f) + 1.0f) * _418;
  float _443 = _427 - (floor(_427 * 0.0034602077212184668f) * 289.0f);
  float _444 = _428 - (floor(_428 * 0.0034602077212184668f) * 289.0f);
  float _445 = _429 - (floor(_429 * 0.0034602077212184668f) * 289.0f);
  float _446 = _430 - (floor(_430 * 0.0034602077212184668f) * 289.0f);
  float _459 = _443 - (floor(_443 * 0.020408164709806442f) * 49.0f);
  float _460 = _444 - (floor(_444 * 0.020408164709806442f) * 49.0f);
  float _461 = _445 - (floor(_445 * 0.020408164709806442f) * 49.0f);
  float _462 = _446 - (floor(_446 * 0.020408164709806442f) * 49.0f);
  float _467 = floor(_459 * 0.1428571492433548f);
  float _468 = floor(_460 * 0.1428571492433548f);
  float _469 = floor(_461 * 0.1428571492433548f);
  float _470 = floor(_462 * 0.1428571492433548f);
  float _487 = (_467 * 0.2857142984867096f) + -0.9285714030265808f;
  float _488 = (_468 * 0.2857142984867096f) + -0.9285714030265808f;
  float _489 = (_469 * 0.2857142984867096f) + -0.9285714030265808f;
  float _490 = (_470 * 0.2857142984867096f) + -0.9285714030265808f;
  float _495 = (floor(_459 - (_467 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _496 = (floor(_460 - (_468 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _497 = (floor(_461 - (_469 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _498 = (floor(_462 - (_470 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _511 = (1.0f - abs(_487)) - abs(_495);
  float _512 = (1.0f - abs(_488)) - abs(_496);
  float _513 = (1.0f - abs(_489)) - abs(_497);
  float _514 = (1.0f - abs(_490)) - abs(_498);
  float _543 = select((_511 > 0.0f), -0.0f, -1.0f);
  float _544 = select((_512 > 0.0f), -0.0f, -1.0f);
  float _545 = select((_513 > 0.0f), -0.0f, -1.0f);
  float _546 = select((_514 > 0.0f), -0.0f, -1.0f);
  float _551 = (((floor(_487) * 2.0f) + 1.0f) * _543) + _487;
  float _552 = (((floor(_495) * 2.0f) + 1.0f) * _543) + _495;
  float _553 = (((floor(_488) * 2.0f) + 1.0f) * _544) + _488;
  float _554 = (((floor(_496) * 2.0f) + 1.0f) * _544) + _496;
  float _559 = (((floor(_489) * 2.0f) + 1.0f) * _545) + _489;
  float _560 = (((floor(_497) * 2.0f) + 1.0f) * _545) + _497;
  float _561 = (((floor(_490) * 2.0f) + 1.0f) * _546) + _490;
  float _562 = (((floor(_498) * 2.0f) + 1.0f) * _546) + _498;
  float _571 = 1.7928400039672852f - (dot(float3(_551, _552, _511), float3(_551, _552, _511)) * 0.8537350296974182f);
  float _572 = 1.7928400039672852f - (dot(float3(_553, _554, _512), float3(_553, _554, _512)) * 0.8537350296974182f);
  float _573 = 1.7928400039672852f - (dot(float3(_559, _560, _513), float3(_559, _560, _513)) * 0.8537350296974182f);
  float _574 = 1.7928400039672852f - (dot(float3(_561, _562, _514), float3(_561, _562, _514)) * 0.8537350296974182f);
  float _595 = max((0.6000000238418579f - dot(float3(_301, _302, _303), float3(_301, _302, _303))), 0.0f);
  float _596 = max((0.6000000238418579f - dot(float3(_322, _323, _324), float3(_322, _323, _324))), 0.0f);
  float _597 = max((0.6000000238418579f - dot(float3(_328, _329, _330), float3(_328, _329, _330))), 0.0f);
  float _598 = max((0.6000000238418579f - dot(float3(_331, _332, _333), float3(_331, _332, _333))), 0.0f);
  float _599 = _595 * _595;
  float _600 = _596 * _596;
  float _601 = _597 * _597;
  float _602 = _598 * _598;
  float _617 = saturate((((sin(_280 - _281) * 0.15000000596046448f) + 0.050000011920928955f) + (dot(float4((_599 * _599), (_600 * _600), (_601 * _601), (_602 * _602)), float4(dot(float3((_571 * _551), (_571 * _552), (_571 * _511)), float3(_301, _302, _303)), dot(float3((_572 * _553), (_572 * _554), (_572 * _512)), float3(_322, _323, _324)), dot(float3((_573 * _559), (_573 * _560), (_573 * _513)), float3(_328, _329, _330)), dot(float3((_574 * _561), (_574 * _562), (_574 * _514)), float3(_331, _332, _333)))) * 21.0f)) * 4.0f);
  float _621 = (_617 * _617) * (3.0f - (_617 * 2.0f));
  float _623 = (_621 * 0.6499999761581421f) + 0.3499999940395355f;
  float _628 = (_242 * 0.5f) - _286;
  float _629 = (_257 * 0.004444444552063942f) - _286;
  float _630 = dot(float3(_628, _629, _289), float3(0.3333333432674408f, 0.3333333432674408f, 0.3333333432674408f));
  float _634 = floor(_630 + _628);
  float _635 = floor(_630 + _629);
  float _636 = floor(_630 + _289);
  float _640 = dot(float3(_634, _635, _636), float3(0.1666666716337204f, 0.1666666716337204f, 0.1666666716337204f));
  float _641 = _640 + (_628 - _634);
  float _642 = _640 + (_629 - _635);
  float _643 = (_289 - _636) + _640;
  float _647 = select((_641 < _642), 0.0f, 1.0f);
  float _648 = select((_642 < _643), 0.0f, 1.0f);
  float _649 = select((_643 < _641), 0.0f, 1.0f);
  float _650 = 1.0f - _647;
  float _651 = 1.0f - _648;
  float _652 = 1.0f - _649;
  float _653 = min(_647, _652);
  float _654 = min(_648, _650);
  float _655 = min(_649, _651);
  float _656 = max(_647, _652);
  float _657 = max(_648, _650);
  float _658 = max(_649, _651);
  float _662 = (_641 - _653) + 0.1666666716337204f;
  float _663 = (_642 - _654) + 0.1666666716337204f;
  float _664 = (_643 - _655) + 0.1666666716337204f;
  float _668 = (_641 - _656) + 0.3333333432674408f;
  float _669 = (_642 - _657) + 0.3333333432674408f;
  float _670 = (_643 - _658) + 0.3333333432674408f;
  float _671 = _641 + -0.5f;
  float _672 = _642 + -0.5f;
  float _673 = _643 + -0.5f;
  float _683 = _634 - (floor(_634 * 0.0034602077212184668f) * 289.0f);
  float _684 = _635 - (floor(_635 * 0.0034602077212184668f) * 289.0f);
  float _685 = _636 - (floor(_636 * 0.0034602077212184668f) * 289.0f);
  float _686 = _685 + _655;
  float _687 = _685 + _658;
  float _688 = _685 + 1.0f;
  float _697 = ((_685 * 34.0f) + 1.0f) * _685;
  float _698 = ((_686 * 34.0f) + 1.0f) * _686;
  float _699 = ((_687 * 34.0f) + 1.0f) * _687;
  float _700 = ((_688 * 34.0f) + 1.0f) * _688;
  float _714 = (_697 - (floor(_697 * 0.0034602077212184668f) * 289.0f)) + _684;
  float _717 = ((_684 + _654) - (floor(_698 * 0.0034602077212184668f) * 289.0f)) + _698;
  float _720 = ((_684 + _657) - (floor(_699 * 0.0034602077212184668f) * 289.0f)) + _699;
  float _723 = ((_684 + 1.0f) - (floor(_700 * 0.0034602077212184668f) * 289.0f)) + _700;
  float _732 = ((_714 * 34.0f) + 1.0f) * _714;
  float _733 = ((_717 * 34.0f) + 1.0f) * _717;
  float _734 = ((_720 * 34.0f) + 1.0f) * _720;
  float _735 = ((_723 * 34.0f) + 1.0f) * _723;
  float _749 = (_732 - (floor(_732 * 0.0034602077212184668f) * 289.0f)) + _683;
  float _752 = ((_683 + _653) - (floor(_733 * 0.0034602077212184668f) * 289.0f)) + _733;
  float _755 = ((_683 + _656) - (floor(_734 * 0.0034602077212184668f) * 289.0f)) + _734;
  float _758 = ((_683 + 1.0f) - (floor(_735 * 0.0034602077212184668f) * 289.0f)) + _735;
  float _767 = ((_749 * 34.0f) + 1.0f) * _749;
  float _768 = ((_752 * 34.0f) + 1.0f) * _752;
  float _769 = ((_755 * 34.0f) + 1.0f) * _755;
  float _770 = ((_758 * 34.0f) + 1.0f) * _758;
  float _783 = _767 - (floor(_767 * 0.0034602077212184668f) * 289.0f);
  float _784 = _768 - (floor(_768 * 0.0034602077212184668f) * 289.0f);
  float _785 = _769 - (floor(_769 * 0.0034602077212184668f) * 289.0f);
  float _786 = _770 - (floor(_770 * 0.0034602077212184668f) * 289.0f);
  float _799 = _783 - (floor(_783 * 0.020408164709806442f) * 49.0f);
  float _800 = _784 - (floor(_784 * 0.020408164709806442f) * 49.0f);
  float _801 = _785 - (floor(_785 * 0.020408164709806442f) * 49.0f);
  float _802 = _786 - (floor(_786 * 0.020408164709806442f) * 49.0f);
  float _807 = floor(_799 * 0.1428571492433548f);
  float _808 = floor(_800 * 0.1428571492433548f);
  float _809 = floor(_801 * 0.1428571492433548f);
  float _810 = floor(_802 * 0.1428571492433548f);
  float _827 = (_807 * 0.2857142984867096f) + -0.9285714030265808f;
  float _828 = (_808 * 0.2857142984867096f) + -0.9285714030265808f;
  float _829 = (_809 * 0.2857142984867096f) + -0.9285714030265808f;
  float _830 = (_810 * 0.2857142984867096f) + -0.9285714030265808f;
  float _835 = (floor(_799 - (_807 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _836 = (floor(_800 - (_808 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _837 = (floor(_801 - (_809 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _838 = (floor(_802 - (_810 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _851 = (1.0f - abs(_827)) - abs(_835);
  float _852 = (1.0f - abs(_828)) - abs(_836);
  float _853 = (1.0f - abs(_829)) - abs(_837);
  float _854 = (1.0f - abs(_830)) - abs(_838);
  float _883 = select((_851 > 0.0f), -0.0f, -1.0f);
  float _884 = select((_852 > 0.0f), -0.0f, -1.0f);
  float _885 = select((_853 > 0.0f), -0.0f, -1.0f);
  float _886 = select((_854 > 0.0f), -0.0f, -1.0f);
  float _891 = (((floor(_827) * 2.0f) + 1.0f) * _883) + _827;
  float _892 = (((floor(_835) * 2.0f) + 1.0f) * _883) + _835;
  float _893 = (((floor(_828) * 2.0f) + 1.0f) * _884) + _828;
  float _894 = (((floor(_836) * 2.0f) + 1.0f) * _884) + _836;
  float _899 = (((floor(_829) * 2.0f) + 1.0f) * _885) + _829;
  float _900 = (((floor(_837) * 2.0f) + 1.0f) * _885) + _837;
  float _901 = (((floor(_830) * 2.0f) + 1.0f) * _886) + _830;
  float _902 = (((floor(_838) * 2.0f) + 1.0f) * _886) + _838;
  float _911 = 1.7928400039672852f - (dot(float3(_891, _892, _851), float3(_891, _892, _851)) * 0.8537350296974182f);
  float _912 = 1.7928400039672852f - (dot(float3(_893, _894, _852), float3(_893, _894, _852)) * 0.8537350296974182f);
  float _913 = 1.7928400039672852f - (dot(float3(_899, _900, _853), float3(_899, _900, _853)) * 0.8537350296974182f);
  float _914 = 1.7928400039672852f - (dot(float3(_901, _902, _854), float3(_901, _902, _854)) * 0.8537350296974182f);
  float _935 = max((0.6000000238418579f - dot(float3(_641, _642, _643), float3(_641, _642, _643))), 0.0f);
  float _936 = max((0.6000000238418579f - dot(float3(_662, _663, _664), float3(_662, _663, _664))), 0.0f);
  float _937 = max((0.6000000238418579f - dot(float3(_668, _669, _670), float3(_668, _669, _670))), 0.0f);
  float _938 = max((0.6000000238418579f - dot(float3(_671, _672, _673), float3(_671, _672, _673))), 0.0f);
  float _939 = _935 * _935;
  float _940 = _936 * _936;
  float _941 = _937 * _937;
  float _942 = _938 * _938;
  float _957 = saturate((((sin((_257 * 2.5f) - _281) * 0.15000000596046448f) + 0.050000011920928955f) + (dot(float4((_939 * _939), (_940 * _940), (_941 * _941), (_942 * _942)), float4(dot(float3((_911 * _891), (_911 * _892), (_911 * _851)), float3(_641, _642, _643)), dot(float3((_912 * _893), (_912 * _894), (_912 * _852)), float3(_662, _663, _664)), dot(float3((_913 * _899), (_913 * _900), (_913 * _853)), float3(_668, _669, _670)), dot(float3((_914 * _901), (_914 * _902), (_914 * _854)), float3(_671, _672, _673)))) * 21.0f)) * 4.0f);
  float _961 = (_957 * _957) * (3.0f - (_957 * 2.0f));
  float _963 = (_961 * 0.6499999761581421f) + 0.3499999940395355f;
  float _970 = frame_consts.time * 0.15000000596046448f;
  float _971 = (_258 * 0.04444444552063942f) - _970;
  float _972 = _285 - _970;
  float _973 = frame_consts.time * 0.02500000037252903f;
  float _974 = dot(float3(_971, _972, _973), float3(0.3333333432674408f, 0.3333333432674408f, 0.3333333432674408f));
  float _978 = floor(_971 + _974);
  float _979 = floor(_972 + _974);
  float _980 = floor(_973 + _974);
  float _984 = dot(float3(_978, _979, _980), float3(0.1666666716337204f, 0.1666666716337204f, 0.1666666716337204f));
  float _985 = _984 + (_971 - _978);
  float _986 = _984 + (_972 - _979);
  float _987 = (_973 - _980) + _984;
  float _991 = select((_985 < _986), 0.0f, 1.0f);
  float _992 = select((_986 < _987), 0.0f, 1.0f);
  float _993 = select((_987 < _985), 0.0f, 1.0f);
  float _994 = 1.0f - _991;
  float _995 = 1.0f - _992;
  float _996 = 1.0f - _993;
  float _997 = min(_991, _996);
  float _998 = min(_992, _994);
  float _999 = min(_993, _995);
  float _1000 = max(_991, _996);
  float _1001 = max(_992, _994);
  float _1002 = max(_993, _995);
  float _1006 = (_985 - _997) + 0.1666666716337204f;
  float _1007 = (_986 - _998) + 0.1666666716337204f;
  float _1008 = (_987 - _999) + 0.1666666716337204f;
  float _1012 = (_985 - _1000) + 0.3333333432674408f;
  float _1013 = (_986 - _1001) + 0.3333333432674408f;
  float _1014 = (_987 - _1002) + 0.3333333432674408f;
  float _1015 = _985 + -0.5f;
  float _1016 = _986 + -0.5f;
  float _1017 = _987 + -0.5f;
  float _1027 = _978 - (floor(_978 * 0.0034602077212184668f) * 289.0f);
  float _1028 = _979 - (floor(_979 * 0.0034602077212184668f) * 289.0f);
  float _1029 = _980 - (floor(_980 * 0.0034602077212184668f) * 289.0f);
  float _1030 = _1029 + _999;
  float _1031 = _1029 + _1002;
  float _1032 = _1029 + 1.0f;
  float _1041 = ((_1029 * 34.0f) + 1.0f) * _1029;
  float _1042 = ((_1030 * 34.0f) + 1.0f) * _1030;
  float _1043 = ((_1031 * 34.0f) + 1.0f) * _1031;
  float _1044 = ((_1032 * 34.0f) + 1.0f) * _1032;
  float _1058 = (_1041 - (floor(_1041 * 0.0034602077212184668f) * 289.0f)) + _1028;
  float _1061 = ((_1028 + _998) - (floor(_1042 * 0.0034602077212184668f) * 289.0f)) + _1042;
  float _1064 = ((_1028 + _1001) - (floor(_1043 * 0.0034602077212184668f) * 289.0f)) + _1043;
  float _1067 = ((_1028 + 1.0f) - (floor(_1044 * 0.0034602077212184668f) * 289.0f)) + _1044;
  float _1076 = ((_1058 * 34.0f) + 1.0f) * _1058;
  float _1077 = ((_1061 * 34.0f) + 1.0f) * _1061;
  float _1078 = ((_1064 * 34.0f) + 1.0f) * _1064;
  float _1079 = ((_1067 * 34.0f) + 1.0f) * _1067;
  float _1093 = (_1076 - (floor(_1076 * 0.0034602077212184668f) * 289.0f)) + _1027;
  float _1096 = ((_1027 + _997) - (floor(_1077 * 0.0034602077212184668f) * 289.0f)) + _1077;
  float _1099 = ((_1027 + _1000) - (floor(_1078 * 0.0034602077212184668f) * 289.0f)) + _1078;
  float _1102 = ((_1027 + 1.0f) - (floor(_1079 * 0.0034602077212184668f) * 289.0f)) + _1079;
  float _1111 = ((_1093 * 34.0f) + 1.0f) * _1093;
  float _1112 = ((_1096 * 34.0f) + 1.0f) * _1096;
  float _1113 = ((_1099 * 34.0f) + 1.0f) * _1099;
  float _1114 = ((_1102 * 34.0f) + 1.0f) * _1102;
  float _1127 = _1111 - (floor(_1111 * 0.0034602077212184668f) * 289.0f);
  float _1128 = _1112 - (floor(_1112 * 0.0034602077212184668f) * 289.0f);
  float _1129 = _1113 - (floor(_1113 * 0.0034602077212184668f) * 289.0f);
  float _1130 = _1114 - (floor(_1114 * 0.0034602077212184668f) * 289.0f);
  float _1143 = _1127 - (floor(_1127 * 0.020408164709806442f) * 49.0f);
  float _1144 = _1128 - (floor(_1128 * 0.020408164709806442f) * 49.0f);
  float _1145 = _1129 - (floor(_1129 * 0.020408164709806442f) * 49.0f);
  float _1146 = _1130 - (floor(_1130 * 0.020408164709806442f) * 49.0f);
  float _1151 = floor(_1143 * 0.1428571492433548f);
  float _1152 = floor(_1144 * 0.1428571492433548f);
  float _1153 = floor(_1145 * 0.1428571492433548f);
  float _1154 = floor(_1146 * 0.1428571492433548f);
  float _1171 = (_1151 * 0.2857142984867096f) + -0.9285714030265808f;
  float _1172 = (_1152 * 0.2857142984867096f) + -0.9285714030265808f;
  float _1173 = (_1153 * 0.2857142984867096f) + -0.9285714030265808f;
  float _1174 = (_1154 * 0.2857142984867096f) + -0.9285714030265808f;
  float _1179 = (floor(_1143 - (_1151 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _1180 = (floor(_1144 - (_1152 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _1181 = (floor(_1145 - (_1153 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _1182 = (floor(_1146 - (_1154 * 7.0f)) * 0.2857142984867096f) + -0.9285714030265808f;
  float _1195 = (1.0f - abs(_1171)) - abs(_1179);
  float _1196 = (1.0f - abs(_1172)) - abs(_1180);
  float _1197 = (1.0f - abs(_1173)) - abs(_1181);
  float _1198 = (1.0f - abs(_1174)) - abs(_1182);
  float _1227 = select((_1195 > 0.0f), -0.0f, -1.0f);
  float _1228 = select((_1196 > 0.0f), -0.0f, -1.0f);
  float _1229 = select((_1197 > 0.0f), -0.0f, -1.0f);
  float _1230 = select((_1198 > 0.0f), -0.0f, -1.0f);
  float _1235 = (((floor(_1171) * 2.0f) + 1.0f) * _1227) + _1171;
  float _1236 = (((floor(_1179) * 2.0f) + 1.0f) * _1227) + _1179;
  float _1237 = (((floor(_1172) * 2.0f) + 1.0f) * _1228) + _1172;
  float _1238 = (((floor(_1180) * 2.0f) + 1.0f) * _1228) + _1180;
  float _1243 = (((floor(_1173) * 2.0f) + 1.0f) * _1229) + _1173;
  float _1244 = (((floor(_1181) * 2.0f) + 1.0f) * _1229) + _1181;
  float _1245 = (((floor(_1174) * 2.0f) + 1.0f) * _1230) + _1174;
  float _1246 = (((floor(_1182) * 2.0f) + 1.0f) * _1230) + _1182;
  float _1255 = 1.7928400039672852f - (dot(float3(_1235, _1236, _1195), float3(_1235, _1236, _1195)) * 0.8537350296974182f);
  float _1256 = 1.7928400039672852f - (dot(float3(_1237, _1238, _1196), float3(_1237, _1238, _1196)) * 0.8537350296974182f);
  float _1257 = 1.7928400039672852f - (dot(float3(_1243, _1244, _1197), float3(_1243, _1244, _1197)) * 0.8537350296974182f);
  float _1258 = 1.7928400039672852f - (dot(float3(_1245, _1246, _1198), float3(_1245, _1246, _1198)) * 0.8537350296974182f);
  float _1279 = max((0.6000000238418579f - dot(float3(_985, _986, _987), float3(_985, _986, _987))), 0.0f);
  float _1280 = max((0.6000000238418579f - dot(float3(_1006, _1007, _1008), float3(_1006, _1007, _1008))), 0.0f);
  float _1281 = max((0.6000000238418579f - dot(float3(_1012, _1013, _1014), float3(_1012, _1013, _1014))), 0.0f);
  float _1282 = max((0.6000000238418579f - dot(float3(_1015, _1016, _1017), float3(_1015, _1016, _1017))), 0.0f);
  float _1283 = _1279 * _1279;
  float _1284 = _1280 * _1280;
  float _1285 = _1281 * _1281;
  float _1286 = _1282 * _1282;
  float _1301 = saturate((((sin(_280 - (frame_consts.time * 1.5f)) * 0.15000000596046448f) + 0.050000011920928955f) + (dot(float4((_1283 * _1283), (_1284 * _1284), (_1285 * _1285), (_1286 * _1286)), float4(dot(float3((_1255 * _1235), (_1255 * _1236), (_1255 * _1195)), float3(_985, _986, _987)), dot(float3((_1256 * _1237), (_1256 * _1238), (_1256 * _1196)), float3(_1006, _1007, _1008)), dot(float3((_1257 * _1243), (_1257 * _1244), (_1257 * _1197)), float3(_1012, _1013, _1014)), dot(float3((_1258 * _1245), (_1258 * _1246), (_1258 * _1198)), float3(_1015, _1016, _1017)))) * 21.0f)) * 4.0f);
  float _1305 = (_1301 * _1301) * (3.0f - (_1301 * 2.0f));
  float _1307 = (_1305 * 0.6499999761581421f) + 0.3499999940395355f;
  float _1329 = saturate(_623);
  float _1330 = saturate(_963);
  float _1352 = (((_167 * 1.2000000476837158f) * _172) * frame_consts.params.vignette.golden_intensity) * ((((saturate(11.0f - (sqrt((_264 * _264) + (_263 * _263)) / ((_961 * 0.039000000804662704f) + 0.08100000768899918f))) * _963) + (saturate(11.0f - (sqrt((_259 * _259) + _269) / ((_621 * 0.039000000804662704f) + 0.08100000768899918f))) * _623)) + (saturate(11.0f - (sqrt((_276 * _276) + _269) / ((_1305 * 0.039000000804662704f) + 0.08100000768899918f))) * _1307)) + (((((saturate(1.0f - (abs(_260) * 0.8333333134651184f)) * _1329) + (saturate(1.0f - (abs(dot(float2(_263, _264), float2(-0.8660253882408142f, 0.5f))) * 0.8333333134651184f)) * _1330)) * saturate(_1307)) + ((_1329 * saturate(1.0f - (abs(dot(float2(_259, _260), float2(0.8660253882408142f, 0.5f))) * 0.8333333134651184f))) * _1330)) * 0.5f));
  SV_Target.x = ((_1352 * ((_219 * _219) - _181)) + _181);
  SV_Target.y = ((_1352 * ((_220 * _220) - _182)) + _182);
  SV_Target.z = ((_1352 * ((_221 * _221) - _183)) + _183);
  if (RENODX_TONE_MAP_TYPE) {
    SV_Target.rgb = renodx::draw::ToneMapPass(_27.rgb, SV_Target.rgb);
  } else {
    SV_Target.rgb = saturate(SV_Target.rgb);
  }
  SV_Target.rgb = renodx::draw::RenderIntermediatePass(SV_Target.rgb);

  SV_Target.w = 1.0f;
  return SV_Target;
}
